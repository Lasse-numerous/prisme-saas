/**
 * Base form component for User.
 *
 * ⚠️ AUTO-GENERATED BY PRISM - DO NOT EDIT
 */

import { type ReactElement } from 'react';
import { useForm, Controller } from 'react-hook-form';
import { useWidgetRegistry } from '../../prism/widgets';
import type { FieldSpec } from '../../prism/widgets/types';
import type { UserCreate } from '../../types/generated';

/** Field specifications for User form */
export const USER_FIELD_SPECS: FieldSpec[] = [
  { name: 'email', type: 'string', required: true, displayName: 'Email', description: 'User email address' },
  { name: 'emailVerified', type: 'boolean', required: false, displayName: 'Email Verified', description: 'Whether email has been verified' },
  { name: 'mfaEnabled', type: 'boolean', required: false, displayName: 'Mfa Enabled', description: 'Whether MFA is enabled' },
  { name: 'subdomainLimit', type: 'integer', required: false, displayName: 'Subdomain Limit', description: 'Maximum number of subdomains allowed' },
  { name: 'isAdmin', type: 'boolean', required: false, displayName: 'Is Admin', description: 'Whether user has admin privileges' },
  { name: 'authentikId', type: 'string', required: false, displayName: 'Authentik Id', description: 'Authentik user ID for SSO' },
  { name: 'username', type: 'string', required: false, displayName: 'Username', description: 'Username (optional, email is primary)' },
  { name: 'roles', type: 'json', required: false, displayName: 'Roles', description: 'User roles for authorization' },
  { name: 'isActive', type: 'boolean', required: false, displayName: 'Is Active', description: 'Whether user account is active' }
];

export interface UserFormBaseProps {
  /** Form submission handler */
  onSubmit: (data: UserCreate) => void | Promise<void>;
  /** Default values for the form */
  defaultValues?: Partial<UserCreate>;
  /** Loading state */
  loading?: boolean;
  /** Submit button text */
  submitLabel?: string;
  /** Cancel handler */
  onCancel?: () => void;
}

/**
 * Base form component for creating/editing User.
 * Extend this in components/user/UserForm.tsx
 */
export function UserFormBase({
  onSubmit,
  defaultValues,
  loading = false,
  submitLabel = 'Save',
  onCancel,
}: UserFormBaseProps): ReactElement {
  const registry = useWidgetRegistry();
  const {
    control,
    handleSubmit,
    formState: { errors },
  } = useForm<UserCreate>({ defaultValues });

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-5">
      {USER_FIELD_SPECS.map((field) => {
        const Widget = registry.resolve(
          'User',
          field.name,
          field.type,
          field.uiWidget
        );

        return (
          <Controller
            key={field.name}
            name={field.name as keyof UserCreate}
            control={control}
            rules={{ required: field.required }}
            render={({ field: { onChange, value } }) => (
              <Widget
                name={field.name}
                value={value}
                onChange={onChange}
                label={field.displayName ?? field.name}
                description={field.description}
                placeholder={field.placeholder}
                required={field.required}
                disabled={loading}
                error={errors[field.name as keyof UserCreate]?.message as string | undefined}
                options={field.enumValues}
                references={field.references}
                {...field.widgetProps}
              />
            )}
          />
        );
      })}

      <div className="flex items-center justify-end gap-3 pt-4 border-t border-nordic-100">
        {onCancel && (
          <button
            type="button"
            onClick={onCancel}
            disabled={loading}
            className="btn-secondary"
          >
            Cancel
          </button>
        )}
        <button type="submit" disabled={loading} className="btn-primary">
          {loading ? (
            <span className="flex items-center gap-2">
              <svg className="animate-spin w-4 h-4" fill="none" viewBox="0 0 24 24">
                <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" />
                <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z" />
              </svg>
              Saving...
            </span>
          ) : submitLabel}
        </button>
      </div>
    </form>
  );
}
