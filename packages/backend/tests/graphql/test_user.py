"""GraphQL tests for User.

⚠️ AUTO-GENERATED BY PRISM - DO NOT EDIT
"""

from __future__ import annotations

import pytest
from tests.factories.user import UserFactory


class TestUserGraphQL:
    """GraphQL tests for User queries and mutations."""

    @pytest.mark.asyncio
    async def test_query_user(self, client, db):
        """Test user query."""
        UserFactory._meta.sqlalchemy_session = db
        instance = UserFactory.create()
        await db.commit()

        query = """
            query GetUser($id: Int!) {
                user(id: $id) {
                    id
                }
            }
        """

        response = await client.post(
            "/graphql",
            json={"query": query, "variables": {"id": instance.id}},
        )

        assert response.status_code == 200
        data = response.json()
        assert "data" in data
        assert data["data"]["user"] is not None, (
            f"Query returned None. Errors: {data.get('errors')}"
        )
        assert data["data"]["user"]["id"] == instance.id

    @pytest.mark.asyncio
    async def test_query_users_list(self, client, db):
        """Test users list query."""
        UserFactory._meta.sqlalchemy_session = db
        for _ in range(3):
            UserFactory.create()
        await db.commit()

        query = """
            query ListUsers {
                users {
                    edges {
                        node {
                            id
                        }
                    }
                    totalCount
                }
            }
        """

        response = await client.post("/graphql", json={"query": query})

        assert response.status_code == 200
        data = response.json()
        assert "data" in data
        assert data["data"]["users"]["totalCount"] >= 3
