"""API integration tests for AllowedEmailDomain.

⚠️ AUTO-GENERATED BY PRISM - DO NOT EDIT
"""

from __future__ import annotations

import pytest
from tests.factories.allowed_email_domain import AllowedEmailDomainFactory


class TestAllowedEmailDomainAPI:
    """API integration tests for AllowedEmailDomain endpoints."""

    @pytest.mark.asyncio
    async def test_list_allowed_email_domains(self, client, db):
        """Test GET /allowed-email-domains"""
        # Create test data
        AllowedEmailDomainFactory._meta.sqlalchemy_session = db
        for _ in range(3):
            AllowedEmailDomainFactory.create()
        await db.commit()

        response = await client.get("/api/allowed-email-domains")

        assert response.status_code == 200
        data = response.json()
        assert "items" in data
        assert len(data["items"]) >= 3

    @pytest.mark.asyncio
    async def test_get_allowed_email_domain(self, client, db):
        """Test GET /allowed-email-domains/{id}"""
        AllowedEmailDomainFactory._meta.sqlalchemy_session = db
        instance = AllowedEmailDomainFactory.create()
        await db.commit()

        response = await client.get(f"/api/allowed-email-domains/{instance.id}")

        assert response.status_code == 200
        data = response.json()
        assert data["id"] == instance.id

    @pytest.mark.asyncio
    async def test_get_allowed_email_domain_not_found(self, client):
        """Test GET /allowed-email-domains/{id} with invalid ID"""
        response = await client.get("/api/allowed-email-domains/99999")

        assert response.status_code == 404

    @pytest.mark.asyncio
    async def test_create_allowed_email_domain(self, client):
        """Test POST /allowed-email-domains"""
        payload = {
            "domain": "test_value_api",
        }

        response = await client.post("/api/allowed-email-domains", json=payload)

        assert response.status_code == 201
        data = response.json()
        assert "id" in data

    @pytest.mark.asyncio
    async def test_update_allowed_email_domain(self, client, db):
        """Test PATCH /allowed-email-domains/{id}"""
        AllowedEmailDomainFactory._meta.sqlalchemy_session = db
        instance = AllowedEmailDomainFactory.create()
        await db.commit()

        payload = {
            "is_active": True,
        }

        response = await client.patch(f"/api/allowed-email-domains/{instance.id}", json=payload)

        assert response.status_code == 200

    @pytest.mark.asyncio
    async def test_delete_allowed_email_domain(self, client, db):
        """Test DELETE /allowed-email-domains/{id}"""
        AllowedEmailDomainFactory._meta.sqlalchemy_session = db
        instance = AllowedEmailDomainFactory.create()
        await db.commit()

        response = await client.delete(f"/api/allowed-email-domains/{instance.id}")

        assert response.status_code == 204
