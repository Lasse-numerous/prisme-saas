# Authentik Blueprint: TOTP MFA Configuration
# Optional TOTP (authenticator app) MFA for users
version: 1
metadata:
  name: TOTP MFA Setup
  labels:
    blueprints.goauthentik.io/instantiate: "true"

entries:
  # TOTP Authenticator Setup Stage (for users to enroll in settings)
  - model: authentik_stages_authenticator_totp.authenticatortotpstage
    id: totp-setup-stage
    identifiers:
      name: madewithprisme-totp-setup
    attrs:
      name: madewithprisme-totp-setup
      friendly_name: "Authenticator App"
      digits: 6

  # Add TOTP setup to user settings flow
  - model: authentik_flows.flowstagebinding
    id: totp-settings-binding
    identifiers:
      target: !Find [authentik_flows.flow, [slug, default-user-settings-flow]]
      stage: !Find [authentik_stages_authenticator_totp.authenticatortotpstage, [name, madewithprisme-totp-setup]]
    attrs:
      order: 10
